
# This Makefile has been generated by the packaging/configure script.
# It has been modified manually
#  DO NOT run php-packager-configure again

NAME=samsondoors-co-uk-site
VERSION=`cat VERSION`
MAINTAINER=Andrea Morello <andrea.morello@linhunix.com>
PACKAGENAME=samsondoors-co-uk-site
PACKAGETYPE=rpm
URL=http://git.linhunix.com:7990/projects/DOVE/repos/samsondoors.co.uk/browse
ARCH=all
DEPENDS=
DESCRIPTION=samsondoors.co.uk
POSTINST=
PREINST=
POSTRM=
PRERM=
DEBCONFCONFIG=
DEBCONFTEMPLATE=
CONFIGFILE=
TEMPLATEDIR=pkgtemplates
TMP=/tmp
ENV=
PTMP=$(TMP)/$(PACKAGENAME)

all: package

clean:
	rm -rf $(PTMP)

structure: clean
	mkdir -p $(PTMP)/src $(PTMP)/build $(PTMP)/misc
	rsync -rl --exclude packaging --exclude Makefile \
		--exclude packaging_config.php --exclude '.git*' --exclude '.svn' \
		--exclude '.CVS' --exclude "$(TMP)" . $(PTMP)/src

template: structure
	php-packager-template $(PTMP)/src/$(TEMPLATEDIR) $(ENV)

build: template
	mkdir -p $(PTMP)/build/home/samsondoors/public_html
	rsync -a    --exclude pkgtemplates \
		    --exclude composer.json \
		    --exclude composer.lock \
		    --exclude older-code  \
		    --exclude webstat  \
		    --exclude dbmigrations/Tools/dbanonymise.php \
		    --exclude lib/dbmigrations/Tools \
		    --exclude lib/dbmigrations/dump \
		    --exclude README.md \
		    --exclude README.html \
		    --exclude docs \
		    --exclude mysql \
		    --exclude UserFiles/Image \
		    --exclude tests \
		     $(PTMP)/src/ $(PTMP)/build/home/samsondoors/public_html/

package: build
	fpm -s dir  -t $(PACKAGETYPE) \
		    -n "$(PACKAGENAME)" \
		    -v "$(VERSION)" \
		    -m "$(MAINTAINER)" \
		    --url "$(URL)" \
		    --description "$(DESCRIPTION)" \
		$(DEPENDS) \
		$(POSTINST) \
		$(PREINST) \
		$(POSTRM) \
		$(PRERM) \
		$(DEBCONFCONFIG) \
		$(DEBCONFTEMPLATE) \
		$(CONFIGFILE) \
		-a $(ARCH) \
		-C $(PTMP)/build \
		-p $(PTMP)/$(PACKAGENAME)_$(VERSION)_$(ARCH).$(PACKAGETYPE) .

migratestatus:
	vendor/bin/doctrine-migrations migrations:status  --db-configuration migrations-db.php
	
migratenext:
	vendor/bin/doctrine-migrations migrations:migrate next  --db-configuration migrations-db.php

migrateprev:
	vendor/bin/doctrine-migrations migrations:migrate prev  --db-configuration migrations-db.php

migrategen:
	vendor/bin/doctrine-migrations migrations:generate  --db-configuration migrations-db.php