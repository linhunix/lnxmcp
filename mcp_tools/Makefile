
# This Makefile has been generated by the packaging/configure script.
# It has been modified manually
#  DO NOT run php-packager-configure again

NAME=lnxmcp
VERSION=`cat VERSION`
MAINTAINER=Andrea Morello <andrea.morello@linhunix.com>
PACKAGENAME=lnxmcp
PACKAGETYPE=rpm
URL=https://github.com/linhunix/lnxmcp
ARCH=all
DEPENDS=
DESCRIPTION=LinHUniX - Master Control Program - MVC
POSTINST=
PREINST=
POSTRM=
PRERM=
DEBCONFCONFIG=
DEBCONFTEMPLATE=
CONFIGFILE=
TEMPLATEDIR=pkgtemplates
TMP=/tmp
ENV=
PTMP=$(TMP)/$(PACKAGENAME)

all: package

clean:
	rm -rf $(PTMP)

structure: clean
	mkdir -p $(PTMP)/mcp $(PTMP)/build $(PTMP)/misc
	rsync -rl --exclude packaging --exclude Makefile \
		--exclude packaging_config.php --exclude '.git*' --exclude '.svn' \
		--exclude '.CVS' --exclude "$(TMP)" . $(PTMP)/mcp

template: structure
	php-packager-template $(PTMP)/mcp/$(TEMPLATEDIR) $(ENV)

build: template
	mkdir -p $(PTMP)/build/home/samsondoors/public_html
	rsync -a    --exclude pkgtemplates \
		    --exclude composer.json \
		    --exclude composer.lock \
		    --exclude webstat  \
		    --exclude README.md \
		    --exclude docs \
		    --exclude backup \
		    --exclude mcp_tests \
		     $(PTMP)/mcp/ $(PTMP)/build/opt/lnxmcp/

package: build
	fpm -s dir  -t $(PACKAGETYPE) \
		    -n "$(PACKAGENAME)" \
		    -v "$(VERSION)" \
		    -m "$(MAINTAINER)" \
		    --url "$(URL)" \
		    --description "$(DESCRIPTION)" \
		$(DEPENDS) \
		$(POSTINST) \
		$(PREINST) \
		$(POSTRM) \
		$(PRERM) \
		$(DEBCONFCONFIG) \
		$(DEBCONFTEMPLATE) \
		$(CONFIGFILE) \
		-a $(ARCH) \
		-C $(PTMP)/build \
		-p $(PTMP)/$(PACKAGENAME)_$(VERSION)_$(ARCH).$(PACKAGETYPE) .

test:
php app.php lnxmcp-chk mcp/test
php app.php lnxmcp-chk app/test